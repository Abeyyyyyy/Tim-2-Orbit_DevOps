<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laravel Auth System - SMKN 4 Bandung</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-indigo-50 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-4xl">
        <!-- Login Form -->
        <div id="loginForm" class="bg-white rounded-3xl shadow-2xl overflow-hidden transition-all duration-300 transform hover:scale-[1.02] border border-gray-100">
            <div class="flex">
                <div class="w-1/2 bg-gradient-to-br from-blue-500 to-indigo-600 p-10 flex flex-col justify-center">
                    <div class="text-center mb-8">
                        <i class="fas fa-school text-4xl text-white mb-4"></i>
                        <h2 class="text-3xl font-bold text-white mb-2">SMKN 4 Bandung</h2>
                        <p class="text-blue-100 text-lg">Sekolah Menengah Kejuruan Negeri 4 Bandung</p>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-4">Hello, Welcome!</h2>
                    <p class="text-blue-100 text-lg">Don't have an account?</p>
                    <button onclick="showRegister()" class="mt-6 px-6 py-3 bg-white text-blue-600 rounded-xl font-medium hover:bg-gray-100 transition-all duration-300 transform hover:scale-105">
                        Register
                    </button>
                </div>
                <div class="w-1/2 p-10">
                    <div class="text-center mb-8">
                        <i class="fas fa-user-lock text-4xl text-blue-600 mb-4"></i>
                        <h1 class="text-3xl font-bold text-gray-800">Login to Your Account</h1>
                    </div>
                    
                    <form id="loginForm" onsubmit="handleLogin(event)">
                        <div class="mb-6">
                            <label for="email" class="block text-lg font-medium text-gray-700 mb-3">Email/Username</label>
                            <div class="relative">
                                <input type="text" id="email" name="email" required class="w-full px-5 py-4 border border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-500 focus:border-transparent transition-all duration-300 text-lg">
                                <div class="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none">
                                    <i class="fas fa-user text-gray-400 text-lg"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <label for="password" class="block text-lg font-medium text-gray-700 mb-3">Password</label>
                            <div class="relative">
                                <input type="password" id="password" name="password" required class="w-full px-5 py-4 border border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-500 focus:border-transparent transition-all duration-300 text-lg">
                                <div class="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none">
                                    <i class="fas fa-lock text-gray-400 text-lg"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-8">
                            <a href="#" class="text-lg text-blue-600 hover:text-blue-800 transition-colors">Forgot password?</a>
                        </div>
                        
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl">
                            Login
                        </button>
                        
                        <div class="mt-10 text-center">
                            <p class="text-lg text-gray-600 mb-6">or login with social platforms</p>
                            <div class="flex justify-center space-x-6">
                                <button type="button" class="w-14 h-14 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center transition-all duration-300 transform hover:scale-110">
                                    <i class="fab fa-google text-red-500 text-xl"></i>
                                </button>
                                <button type="button" class="w-14 h-14 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center transition-all duration-300 transform hover:scale-110">
                                    <i class="fab fa-facebook-f text-blue-600 text-xl"></i>
                                </button>
                                <button type="button" class="w-14 h-14 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center transition-all duration-300 transform hover:scale-110">
                                    <i class="fab fa-twitter text-blue-400 text-xl"></i>
                                </button>
                                <button type="button" class="w-14 h-14 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center transition-all duration-300 transform hover:scale-110">
                                    <i class="fab fa-linkedin-in text-blue-700 text-xl"></i>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Register Form -->
        <div id="registerForm" class="hidden bg-white rounded-3xl shadow-2xl overflow-hidden transition-all duration-300 transform hover:scale-[1.02] mt-8 border border-gray-100">
            <div class="flex">
                <div class="w-1/2 bg-gradient-to-br from-blue-500 to-indigo-600 p-10 flex flex-col justify-center">
                    <div class="text-center mb-8">
                        <i class="fas fa-school text-4xl text-white mb-4"></i>
                        <h2 class="text-3xl font-bold text-white mb-2">SMKN 4 Bandung</h2>
                        <p class="text-blue-100 text-lg">Sekolah Menengah Kejuruan Negeri 4 Bandung</p>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-4">Welcome Back!</h2>
                    <p class="text-blue-100 text-lg">Already have an account?</p>
                    <button onclick="showLogin()" class="mt-6 px-6 py-3 bg-white text-blue-600 rounded-xl font-medium hover:bg-gray-100 transition-all duration-300 transform hover:scale-105">
                        Login
                    </button>
                </div>
                <div class="w-1/2 p-10">
                    <div class="text-center mb-8">
                        <i class="fas fa-user-plus text-4xl text-blue-600 mb-4"></i>
                        <h1 class="text-3xl font-bold text-gray-800">Create Your Account</h1>
                    </div>
                    
                    <form id="registerForm" onsubmit="handleRegister(event)">
                        <div class="mb-6">
                            <label for="username" class="block text-lg font-medium text-gray-700 mb-3">Username</label>
                            <div class="relative">
                                <input type="text" id="username" name="username" required placeholder="Enter your preferred username" class="w-full px-5 py-4 border border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-500 focus:border-transparent transition-all duration-300 text-lg">
                                <div class="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none">
                                    <i class="fas fa-user text-gray-400 text-lg"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <label for="email" class="block text-lg font-medium text-gray-700 mb-3">Email</label>
                            <div class="relative">
                                <input type="email" id="email" name="email" required placeholder="yourname@example.com" class="w-full px-5 py-4 border border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-500 focus:border-transparent transition-all duration-300 text-lg">
                                <div class="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none">
                                    <i class="fas fa-envelope text-gray-400 text-lg"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-8">
                            <label for="password" class="block text-lg font-medium text-gray-700 mb-3">Password</label>
                            <div class="relative">
                                <input type="password" id="password" name="password" required minlength="6" placeholder="Create a strong password (min. 6 characters)" class="w-full px-5 py-4 border border-gray-300 rounded-xl focus:ring-4 focus:ring-blue-500 focus:border-transparent transition-all duration-300 text-lg">
                                <div class="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none">
                                    <i class="fas fa-lock text-gray-400 text-lg"></i>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-xl text-lg transition-all duration-300 transform hover:scale-[1.02] shadow-lg hover:shadow-xl">
                            Register
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Profile Page (Hidden initially) -->
        <div id="profilePage" class="hidden bg-white rounded-3xl shadow-2xl overflow-hidden mt-8 border border-gray-100">
            <div class="p-10">
                <div class="flex justify-between items-center mb-8">
                    <h1 class="text-4xl font-bold text-gray-800">Profile Siswa</h1>
                    <button onclick="logout()" class="px-8 py-4 bg-red-600 hover:bg-red-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg">
                        Logout
                    </button>
                </div>
                
                <div class="bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl p-10 text-white text-center mb-8">
                    <div class="flex justify-center mb-6">
                        <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-user-circle text-6xl text-blue-500"></i>
                        </div>
                    </div>
                    <h2 class="text-3xl font-bold" id="studentName">Nama Siswa</h2>
                    <p class="text-xl text-blue-100 mb-2" id="studentSchool">SMKN 4 Bandung</p>
                    <p class="text-lg text-blue-100" id="studentEmail">Email Address</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                    <div class="bg-gray-50 p-8 rounded-2xl border border-gray-200">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">Biodata Pribadi</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between">
                                <span class="font-medium text-gray-700">Nama Lengkap:</span>
                                <span id="fullName" class="text-gray-800">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-medium text-gray-700">NISN:</span>
                                <span id="nisn" class="text-gray-800">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-medium text-gray-700">Tanggal Lahir:</span>
                                <span id="birthDate" class="text-gray-800">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-medium text-gray-700">Alamat:</span>
                                <span id="address" class="text-gray-800">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-medium text-gray-700">No. HP:</span>
                                <span id="phone" class="text-gray-800">-</span>
                            </div>
                        </div>
                        <button onclick="showEditProfile()" class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-xl transition-colors">
                            Edit Profil
                        </button>
                    </div>
                    
                    <div class="bg-gray-50 p-8 rounded-2xl border border-gray-200">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">Informasi Sekolah</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between">
                                <span class="font-medium text-gray-700">Kelas:</span>
                                <span id="kelas" class="text-gray-800">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-medium text-gray-700">Jurusan:</span>
                                <span id="jurusan" class="text-gray-800">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-medium text-gray-700">Tahun Ajaran:</span>
                                <span id="tahunAjaran" class="text-gray-800">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-medium text-gray-700">Status:</span>
                                <span id="status" class="text-gray-800">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="font-medium text-gray-700">NIP Guru Wali:</span>
                                <span id="guruWali" class="text-gray-800">-</span>
                            </div>
                        </div>
                        <button onclick="showEditProfile()" class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-xl transition-colors">
                            Edit Profil
                        </button>
                    </div>
                </div>
                
                <div class="bg-gray-50 p-8 rounded-2xl border border-gray-200 mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">Media Sosial</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span class="font-medium text-gray-700">Instagram:</span>
                            <span id="instagram" class="text-gray-800">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium text-gray-700">Facebook:</span>
                            <span id="facebook" class="text-gray-800">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium text-gray-700">Twitter/X:</span>
                            <span id="twitter" class="text-gray-800">-</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium text-gray-700">LinkedIn:</span>
                            <span id="linkedin" class="text-gray-800">-</span>
                        </div>
                    </div>
                    <button onclick="showEditProfile()" class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-xl transition-colors">
                        Edit Profil
                    </button>
                </div>
                
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-8 border border-gray-200 text-center">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Selamat Datang di SMKN 4 Bandung</h3>
                    <p class="text-gray-600 text-lg mb-2">Sekolah Menengah Kejuruan Negeri 4 Bandung adalah sekolah unggulan yang berkomitmen untuk mencetak generasi siap kerja dan berdaya saing tinggi.</p>
                    <p class="text-gray-600 text-lg">Jl. Cihampelas No. 123, Bandung, Jawa Barat</p>
                </div>
            </div>
        </div>

        <!-- Edit Profile Modal -->
        <div id="editProfileModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-2xl p-8 w-full max-w-2xl mx-4 max-h-screen overflow-y-auto">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Edit Profil Siswa</h2>
                
                <form id="editProfileForm" onsubmit="saveProfileData(event)">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label for="editFullName" class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
                            <input type="text" id="editFullName" name="fullName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="editUsername" class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                            <input type="text" id="editUsername" name="username" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="editEmail" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" id="editEmail" name="email" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="editNISN" class="block text-sm font-medium text-gray-700 mb-2">NISN</label>
                            <input type="text" id="editNISN" name="nisn" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="editBirthDate" class="block text-sm font-medium text-gray-700 mb-2">Tanggal Lahir</label>
                            <input type="date" id="editBirthDate" name="birthDate" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="editPhone" class="block text-sm font-medium text-gray-700 mb-2">No. HP</label>
                            <input type="tel" id="editPhone" name="phone" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="editAddress" class="block text-sm font-medium text-gray-700 mb-2">Alamat</label>
                            <textarea id="editAddress" name="address" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" rows="2"></textarea>
                        </div>
                        
                        <div>
                            <label for="editGuruWali" class="block text-sm font-medium text-gray-700 mb-2">NIP Guru Wali</label>
                            <input type="text" id="editGuruWali" name="guruWali" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label for="editKelas" class="block text-sm font-medium text-gray-700 mb-2">Kelas</label>
                            <input type="text" id="editKelas" name="kelas" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="editJurusan" class="block text-sm font-medium text-gray-700 mb-2">Jurusan</label>
                            <input type="text" id="editJurusan" name="jurusan" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="editTahunAjaran" class="block text-sm font-medium text-gray-700 mb-2">Tahun Ajaran</label>
                            <input type="text" id="editTahunAjaran" name="tahunAjaran" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="editStatus" class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                            <select id="editStatus" name="status" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Pilih Status</option>
                                <option value="Aktif">Aktif</option>
                                <option value="Tidak Aktif">Tidak Aktif</option>
                                <option value="Lulus">Lulus</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label for="editInstagram" class="block text-sm font-medium text-gray-700 mb-2">Instagram</label>
                            <input type="text" id="editInstagram" name="instagram" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="@username">
                        </div>
                        
                        <div>
                            <label for="editFacebook" class="block text-sm font-medium text-gray-700 mb-2">Facebook</label>
                            <input type="text" id="editFacebook" name="facebook" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="username">
                        </div>
                        
                        <div>
                            <label for="editTwitter" class="block text-sm font-medium text-gray-700 mb-2">Twitter/X</label>
                            <input type="text" id="editTwitter" name="twitter" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="@username">
                        </div>
                        
                        <div>
                            <label for="editLinkedin" class="block text-sm font-medium text-gray-700 mb-2">LinkedIn</label>
                            <input type="text" id="editLinkedin" name="linkedin" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="username">
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeEditProfileModal()" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Show/hide forms
        function showLogin() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('profilePage').classList.add('hidden');
            document.getElementById('editProfileModal').classList.add('hidden');
        }
        
        function showRegister() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('profilePage').classList.add('hidden');
            document.getElementById('editProfileModal').classList.add('hidden');
        }
        
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            
            // Validate inputs
            if (!email || !password) {
                Swal.fire({
                    title: 'Error!',
                    text: 'Please fill in all fields',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            // Check if user exists in database
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const user = users.find(u => u.email === email);
            
            if (!user) {
                Swal.fire({
                    title: 'Error!',
                    text: 'User not found. Please register first.',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            // Check password
            if (user.password !== password) {
                Swal.fire({
                    title: 'Error!',
                    text: 'Invalid password',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            // Login successful
            localStorage.setItem('currentUser', JSON.stringify({
                username: user.username,
                email: user.email
            }));
            
            Swal.fire({
                title: 'Success!',
                text: 'Login successful',
                icon: 'success',
                confirmButtonText: 'OK'
            }).then(() => {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('profilePage').classList.remove('hidden');
                populateProfileData();
            });
        }
        
        function handleRegister(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            
            // Validate inputs
            if (!username || !email || !password) {
                Swal.fire({
                    title: 'Error!',
                    text: 'Please fill in all fields',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            if (password.length < 6) {
                Swal.fire({
                    title: 'Error!',
                    text: 'Password must be at least 6 characters',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            // Simple email validation - must contain @ and .
            if (!email.includes('@') || !email.includes('.')) {
                Swal.fire({
                    title: 'Error!',
                    text: 'Please enter a valid email address (must contain @ and .)',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            // Check if user already exists
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const existingUser = users.find(user => user.email === email);
            
            if (existingUser) {
                Swal.fire({
                    title: 'Error!',
                    text: 'User with this email already exists',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            // Check if username already exists
            const existingUsername = users.find(user => user.username === username);
            if (existingUsername) {
                Swal.fire({
                    title: 'Error!',
                    text: 'Username already taken. Please choose another one.',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            // Create new user
            const newUser = {
                username: username,
                email: email.toLowerCase(),
                password: password,
                fullName: '',
                nisn: '',
                birthDate: '',
                address: '',
                phone: '',
                kelas: '',
                jurusan: '',
                tahunAjaran: '',
                status: 'Aktif',
                guruWali: '',
                instagram: '',
                facebook: '',
                twitter: '',
                linkedin: ''
            };
            
            // Add to users array
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            // Success message
            Swal.fire({
                title: 'Success!',
                text: 'Registration successful! You can now login.',
                icon: 'success',
                confirmButtonText: 'OK'
            }).then(() => {
                // Show login form after registration
                showLogin();
            });
        }
        
        function logout() {
            Swal.fire({
                title: 'Are you sure?',
                text: 'You will be logged out',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Yes, logout',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Clear user session
                    localStorage.removeItem('currentUser');
                    document.getElementById('profilePage').classList.add('hidden');
                    document.getElementById('loginForm').classList.remove('hidden');
                    Swal.fire('Logged out!', '', 'success');
                }
            });
        }
        
        function showEditProfile() {
            // Get current user data
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) {
                Swal.fire({
                    title: 'Error!',
                    text: 'You must be logged in to edit your profile',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const userData = users.find(user => user.email === currentUser.email);
            
            if (!userData) {
                Swal.fire({
                    title: 'Error!',
                    text: 'User data not found',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            // Fill the form with current data
            document.getElementById('editFullName').value = userData.fullName || '';
            document.getElementById('editUsername').value = userData.username || '';
            document.getElementById('editEmail').value = userData.email || '';
            document.getElementById('editNISN').value = userData.nisn || '';
            document.getElementById('editBirthDate').value = userData.birthDate || '';
            document.getElementById('editPhone').value = userData.phone || '';
            document.getElementById('editAddress').value = userData.address || '';
            document.getElementById('editKelas').value = userData.kelas || '';
            document.getElementById('editJurusan').value = userData.jurusan || '';
            document.getElementById('editTahunAjaran').value = userData.tahunAjaran || '';
            document.getElementById('editStatus').value = userData.status || 'Aktif';
            document.getElementById('editGuruWali').value = userData.guruWali || '';
            document.getElementById('editInstagram').value = userData.instagram || '';
            document.getElementById('editFacebook').value = userData.facebook || '';
            document.getElementById('editTwitter').value = userData.twitter || '';
            document.getElementById('editLinkedin').value = userData.linkedin || '';
            
            // Show modal
            document.getElementById('editProfileModal').classList.remove('hidden');
        }
        
        function closeEditProfileModal() {
            document.getElementById('editProfileModal').classList.add('hidden');
        }
        
        function saveProfileData(e) {
            e.preventDefault();
            
            // Get form data
            const formData = new FormData(document.getElementById('editProfileForm'));
            const profileData = {};
            for (let [key, value] of formData.entries()) {
                profileData[key] = value.trim();
            }
            
            // Validate required fields
            const requiredFields = ['fullName', 'username', 'email', 'nisn', 'birthDate', 'kelas', 'jurusan', 'tahunAjaran'];
            for (const field of requiredFields) {
                if (!profileData[field]) {
                    Swal.fire({
                        title: 'Error!',
                        text: `Please fill in the ${field} field`,
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                    return;
                }
            }
            
            // Simple email validation for edit
            if (!profileData.email.includes('@') || !profileData.email.includes('.')) {
                Swal.fire({
                    title: 'Error!',
                    text: 'Please enter a valid email address (must contain @ and .)',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            // Update user data
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const userIndex = users.findIndex(user => user.email === currentUser.email);
            
            if (userIndex !== -1) {
                // Update user data
                Object.assign(users[userIndex], profileData);
                localStorage.setItem('users', JSON.stringify(users));
                
                // Update profile display
                populateProfileData();
                
                // Close modal
                closeEditProfileModal();
                
                // Success message
                Swal.fire({
                    title: 'Success!',
                    text: 'Profile updated successfully',
                    icon: 'success',
                    confirmButtonText: 'OK'
                });
            }
        }
        
        function populateProfileData() {
            // Get current user data
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const userData = users.find(user => user.email === currentUser.email);
            
            if (!userData) {
                // If no user data found, redirect to login
                logout();
                return;
            }
            
            // Update profile elements with actual user data
            document.getElementById('studentName').textContent = userData.fullName || userData.username;
            document.getElementById('studentSchool').textContent = 'SMKN 4 Bandung';
            document.getElementById('studentEmail').textContent = userData.email;
            document.getElementById('fullName').textContent = userData.fullName || '-';
            document.getElementById('nisn').textContent = userData.nisn || '-';
            document.getElementById('birthDate').textContent = userData.birthDate || '-';
            document.getElementById('address').textContent = userData.address || '-';
            document.getElementById('phone').textContent = userData.phone || '-';
            document.getElementById('kelas').textContent = userData.kelas || '-';
            document.getElementById('jurusan').textContent = userData.jurusan || '-';
            document.getElementById('tahunAjaran').textContent = userData.tahunAjaran || '-';
            document.getElementById('status').textContent = userData.status || '-';
            document.getElementById('guruWali').textContent = userData.guruWali || '-';
            document.getElementById('instagram').textContent = userData.instagram || '-';
            document.getElementById('facebook').textContent = userData.facebook || '-';
            document.getElementById('twitter').textContent = userData.twitter || '-';
            document.getElementById('linkedin').textContent = userData.linkedin || '-';
        }
        
        window.onload = function() {
            showLogin();
            if (localStorage.getItem('currentUser')) {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('profilePage').classList.remove('hidden');
                    populateProfileData();
            }
        };
    </script>
</body>
</html>